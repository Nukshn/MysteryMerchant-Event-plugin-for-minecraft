plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '7.1.2'
}

group = 'com.MysteryMerchant'
version = '1.0'
description = 'MysteryMerchant Plugin'

java {
    sourceCompatibility = JavaVersion.VERSION_17
    targetCompatibility = JavaVersion.VERSION_17
}

repositories {
    mavenCentral()
    maven { url = uri('https://hub.spigotmc.org/nexus/content/repositories/snapshots/') }
    maven { url = uri('https://repo.papermc.io/repository/maven-public/') }
    maven { url = uri('https://jitpack.io') }
}

dependencies {
    // Компилируемся против самой новой версии API для форвард-совместимости (плагин использует только стабильные части со времён 1.17)
    compileOnly 'org.spigotmc:spigot-api:1.21.1-R0.1-SNAPSHOT'
    compileOnly 'com.github.MilkBowl:VaultAPI:1.7'
}

processResources {
    duplicatesStrategy = DuplicatesStrategy.INCLUDE
    // Only expand plugin.yml to inject version if needed; avoid expanding all yml (language files with $)
    filesMatching('plugin.yml') {
        expand(version: project.version)
    }
}

tasks.withType(JavaCompile) {
    options.encoding = 'UTF-8'
}

// Regular jar: only project classes + resources (no dependencies); shadowJar will build fat jar
jar {
    archiveFileName = "MysteryMerchant-${version}.jar"
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
}

shadowJar {
    archiveFileName = "MysteryMerchant-${version}.jar"
    minimize()
}

// Ensure shadowJar runs on build
tasks.named('build') {
    dependsOn shadowJar
}

// Wrapper configuration (generate with: gradle wrapper --gradle-version 7.6.4)
tasks.wrapper {
    gradleVersion = '7.6.4'
    distributionType = Wrapper.DistributionType.BIN
}
